---
layout: post
title: "ä¸€ç‚¹ä¸€æ»´æ…¢æ…¢çš„æ­å¼€XMPPçš„ç¥ç§˜é¢çº±"
description: "Bison"
category: iOSä¹‹XMPP
headline: Discover the theme elements
tags: [iOSå¼€å‘ä¹‹XMPPï¼Œxmppï¼ŒiOSèŠå¤©ï¼ŒiOSé€šè®¯ï¼ŒiOSå¼€å‘æŠ€å·§ï¼ŒæŠ€æœ¯åšå®¢]
imagefeature: default_bg.jpg
comments: true
featured: 
mathjax: true
path: /images
---

>&quot;å……å®è‡ªæˆ‘ï¼Œæå‡è‡ªæˆ‘çš„ä»·å€¼ï¼›å”¯æœ‰å¤šå­¦&quot;
><small><cite title="Plato">Bison</cite></small>

>![1]({{ page.path }}/zjs.jpg)<br>
>[å†°ä¹‹ä¾éŸ©ç‰ˆå¥³è£…](http://allluckly.taobao.com/)ï¼ˆç¨‹åºåª›ç¦åˆ©ï¼‰<br>


<br>

`XMPP`æ˜¯å¹²å˜›çš„åœ¨æ­¤å°±ä¸å¤šæ¢è®¨äº†ï¼Œæˆ‘ä¹Ÿæ˜¯åˆšå¼€å§‹å°è¯•ç€å­¦ä¹ ã€‚<br>
é¦–å…ˆæˆ‘ä»¬æŠŠ`XMPP`æ‹‰è¿›å·¥ç¨‹ï¼Œç„¶åå¿…é¡»å¯¼å…¥çš„å‡ ä¸ªæ¡†æ¶ï¼š<br>
`CFNetwork.framework`<br>
`Security.framework`<br>
`libxml2.dylib`<br>
`libresolv.dylib`<br>
`SystemConfiguration.framework`<br>
`CoreLocation.framework`<br>
`AudioToolbox.framework`<br>
`AVFoundation.framework`<br>
è¿è¡Œä¸‹ä¸æŠ¥é”™å°±å¯¹äº†ã€‚ã€‚ã€‚ã€‚ã€‚<br>
åœ¨æˆ‘ä»¬å¼€å‘ä¸­åšèŠå¤©çš„è¯ï¼Œæˆ‘ä»¬é¦–å…ˆæ˜¯éœ€è¦ç™»é™†ï¼Œç™»é™†ä¹‹åè·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œ<br>
è·å–åˆ°ä¿¡æ¯ä¹‹åæˆ‘ä»¬åˆ¤æ–­ä¸‹è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»åœ¨`Openfire`å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±ç›´æ¥ç»™ç”¨æˆ·æ³¨å†Œï¼Œå­˜åœ¨å°±è‡ªåŠ¨èµ‹å€¼ç™»é™†`Openfire`<br>
`[self XmppLogin:dic];`<br>

{% highlight css %}

#pragma mark ç™»é™†xmpp
-(void)XmppLogin:(NSDictionary*)userdic{
Â  Â  App.IM_Account =Â  [NSString stringWithFormat:@"Bison%@",App.UserId];//æ‹¼ä¸Šå‰ç¼€
Â  Â  App.IM_Password =Â  @"**************";
Â  Â  [[JEXMPP Shared] XmppLogin];
}
{% endhighlight %}

<br>

{% highlight css %}

#pragma mark -Â  ç™»å½• é€€å‡º
-(BOOL)XmppLogin{
Â  Â  if (![XMPP_Stream isDisconnected]) {
Â  Â  Â  Â  return YES;
Â  Â  }
Â  Â  [XMPP_Stream setHostName:kIM_Host];//è®¾ç½®æœåŠ¡å™¨
Â  Â  [XMPP_Stream setHostPort:[kIM_Port intValue]];//è®¾ç½®ç«¯å£

Â  Â  NSLog(@"jid:%@ ps:%@",App.IM_Account,App.IM_Password);
Â  Â  if (App.IM_Account == nil || App.IM_Password == nil) {
Â  Â  Â  Â  return NO;
Â  Â  }

Â XMPPJID *myjid = [XMPPJID jidWithString:[NSString stringWithFormat:@"%@@%@",App.IM_Account,kIM_Domain] resource:@"jp"];//è®¾ç½®äº† jid çš„ resource å³é™åˆ¶äº†å¤šç‚¹ç™»é™†
Â Â  Â 
Â  Â  NSError *error ;
Â  Â  [XMPP_Stream setMyJID:myjid];
Â  Â  if (![XMPP_Stream connectWithTimeout:XMPPStreamTimeoutNone error:&error]) {
Â  Â  Â  Â  NSLog(@"my connected error : %@",error.description);
Â  Â  Â  Â  return NO;
Â  Â  }
Â  Â  return YES;
}
{% endhighlight %}

æ¥ä¸‹æ¥å°±æ˜¯éªŒè¯æ˜¯å¦ç™»é™†äº†`Openfire`<br>

{% highlight css %}
//å°†è¦è¿ä¸Š
- (void)xmppStreamWillConnect:(XMPPStream *)sender{
Â  Â  NSLog(@"==xmppStreamWillConnect");
}
//è¿ä¸Šäº† è¿˜è¦éªŒè¯å¯†ç 
- (void)xmppStreamDidConnect:(XMPPStream *)sender{
Â  Â  NSLog(@"xmppStreamDidConnect");
Â  Â  if (App.IM_Password) {
Â  Â  Â  Â  NSError *error ;
Â  Â  Â  Â  if (![XMPP_Stream authenticateWithPassword:App.IM_Password error:&error]) {
Â  Â  Â  Â  Â  Â  NSLog(@"error authenticate : %@",error.description);
Â  Â  Â  Â  }
Â  Â  }
}

//çªç„¶æ‰çº¿äº†
- (void)xmppReconnect:(XMPPReconnect *)sender didDetectAccidentalDisconnect:(SCNetworkReachabilityFlags)reachabilityFlags {
Â  Â  NSLog(@"didDetectAccidentalDisconnect : \n %u ", reachabilityFlags);
}
//YES é‡è¿ 
- (BOOL)xmppReconnect:(XMPPReconnect *)sender shouldAttemptAutoReconnect:(SCNetworkReachabilityFlags)reachabilityFlags{
Â  Â  NSLog(@"shouldAttemptAutoReconnect : \n %u ", reachabilityFlags);
Â  Â  return YES;
}

#pragma mark å‘é€ æˆåŠŸÂ  å¤±è´¥
- (void)xmppStream:(XMPPStream *)sender didSendMessage:(XMPPMessage *)message{

}
//å‘é€å¤±è´¥
- (void)xmppStream:(XMPPStream *)sender didFailToSendMessage:(XMPPMessage *)message error:(NSError *)error{

}
//å‘é€ æˆåŠŸæˆ–å¤±è´¥çš„ åé¦ˆç»™èŠå¤©é¡µé¢
-(void)XmppSend_Status:(NSInteger)status Msg:(JEChatMessage *)msg{
Â  Â  NSLog(@"XmppSend_Status æ¶ˆæ¯å‘é€:%@ \nå†…å®¹:%@", status == 1 ? @"æˆåŠŸ" : @"å¤±è´¥",msg.TextContent);
Â  Â 
Â Â  
}

#pragma mark æ¥æ”¶æ¶ˆæ¯
- (void)xmppStream:(XMPPStream *)sender didReceiveMessage:(XMPPMessage *)message{
Â  Â  NSLog(@"%@\n æ¥æ–°æ¶ˆæ¯äº†\n from:%@\n to:%@\n type:%@\n message:%@\n body:%@",message,[[message attributeForName:@"from"] stringValue],[[message attributeForName:@"to"] stringValue],[[message attributeForName:@"type"] stringValue],[[message attributeForName:@"message"] stringValue],[[message elementForName:@"body"] stringValue]);
}

{% endhighlight %}
ä»Šå¤©æš‚æ—¶è®²åˆ°è¿™ã€‚ã€‚ã€‚ã€‚ã€‚<br>
æœ‰ä¸è¶³ä¹‹å¤„å¸Œæœ›å¤§å®¶æŒ‡ç‚¹å‡ºæ¥å“¦ï¼Œå› ä¸ºæˆ‘ä¹Ÿå¯¹xmppåˆšæ¥è§¦ä¸ä¹…<br>
ç‰ˆæƒå½’Â©Bisonæ‰€æœ‰ ä»»ä½•è½¬è½½è¯·æ ‡æ˜å‡ºå¤„ï¼<br>
 > [æ›´å¤šç»éªŒè¯·ç‚¹å‡»](http://www.allluckly.cn/)

> [åšä¸»appä¸Šçº¿äº†ï¼Œèµ¶ç´§ç‚¹æ­¤æ¥å›´è§‚å§ğŸ˜„](https://itunes.apple.com/us/app/it-blog-zi-xueios-kai-fa-jin/id1067787090?l=zh&ls=1&mt=8)<br>








