---
layout: post
published: true
title: 【iOS开发】自己写日历控件，所要知道全年的总天数算法，星期，月的算法
mathjax: false
featured: true
comments: true
headline: Making blogging easier for masses
category: 
tags: 【iOS开发之Data】
---

{% highlight css %}
- (void)viewDidLoad
{
[super viewDidLoad];

[self getCurrentDate];
[self ShowCurrentDate];
}
{% endhighlight %}



//得到当前年，月，日，星期
{% highlight css %}
-(void)getCurrentDate{
NSCalendar *calendar = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];
NSDate *now;
NSDateComponents *comps = [[NSDateComponents alloc] init];
NSInteger unitFlags = NSYearCalendarUnit | NSMonthCalendarUnit | NSDayCalendarUnit | NSWeekdayCalendarUnit;
now = [NSDate date];
comps = [calendar components:unitFlags fromDate:now];
NSLog(@"%d",comps.week);
currentYear = [comps year];
currentMonth = [comps month];
currentDay = [comps day];
curerntWeek = [comps weekday];
}


//根据当前月返回月的英文名称
-(NSString *)byMonthNumGetMonthName:(NSInteger)month{
    NSString *months[12] = {@"January",@"February",@"March",@"April",@"May",\
    @"June",@"July",@"August",@"September",@"October",@"November",@"December"};
    return months[month - 1];
}


//根据当前年月日获取当年星期
-(NSInteger)CaculateCurDayWeek:(NSInteger)currentYear withmonth:(NSInteger)currentmonth withday:(NSInteger)currentday{
NSInteger total = 0,i;
NSInteger week;
char monthDay[12] = {31,28,31,30,31,30,31,31,30,31,30,31};
for(i = 0; i < currentmonth - 1; i++)
{
total = total + monthDay<i>;
}
total = total + currentday;

if (((currentYear%4 == 0)&&(currentYear%100)) || (currentYear %400 == 0))
total = total + 1;
week = (currentYear-1 + (currentYear-1)/4 - (currentYear-1)/100 + (currentYear-1)/400 + total)%7;
return week;
}


//根据当前年，月得到全年总天数
-(NSInteger)getCurrentYearDayCount:(NSInteger)currentYear withmonth:(NSInteger)currentmonth{
NSInteger total = 0;
char monthDay[12] = {31,28,31,30,31,30,31,31,30,31,30,31};
total = monthDay[currentMonth - 1];
if (currentMonth == 2)
{
if (((currentYear%4 == 0)&&(currentYear%100)) || (currentYear %400 == 0))
{
total = total + 1;
}
}
return total;
}


-(void)removeAllBtn{
for(id obj in [calenderView subviews])
{
if([obj isKindOfClass:[OwnerBtn class]])
[obj removeFromSuperview];
}
}



//创建日历
-(void)ShowCurrentDate{
[self removeAllBtn];

int CurW,i;
NSInteger total = [self getCurrentYearDayCount];
CurW = [self CaculateCurDayWeek:currentMonth withday:1];
CGRect frame;

for(i = 0; i < total; i++)
{
OwnerBtn * dayBtn = [[OwnerBtn alloc] init];

[dayBtn setTitle:[NSString stringWithFormat:@"%d",i + 1] forState:UIControlStateNormal];
[dayBtn setTitle:[NSString stringWithFormat:@"%d",i + 1] forState:UIControlStateHighlighted];
[dayBtn.titleLabel setFont:[UIFont systemFontOfSize:16]];

if (i != currentDay - 1)
{
[dayBtn setTitleColor:SETCOLOR(0,0,0) forState:UIControlStateNormal];
[dayBtn setTitleColor:SETCOLOR(90,183,214) forState:UIControlStateHighlighted];
}
else
{
[dayBtn setTitleColor:[UIColor whiteColor]  forState:UIControlStateNormal];
[dayBtn setTitleColor:[UIColor whiteColor]   forState:UIControlStateHighlighted];

[dayBtn setBackgroundColor:SETCOLOR(90,183,214)];

}


[dayBtn addTarget:self action:@selector(dayBtnActin:) forControlEvents:UIControlEventTouchUpInside];
dayBtn.contentHorizontalAlignment = 2;
[dayBtn setContentHorizontalAlignment:UIControlContentHorizontalAlignmentCenter];
[dayBtn setContentVerticalAlignment:UIControlContentVerticalAlignmentCenter];
dayBtn.userInteractionEnabled = YES;
dayBtn.enabled = YES;
dayBtn.Row = i + 1;


if(appDelegate.isiPhone5)
{
    //BTN FRAME
    frame.origin.x = ((CurW + i)%7)*38+5;
    frame.origin.y = ((CurW + i)/7)*44+100;
    frame.size.width = 42;
    frame.size.height = 44;
}else{
    frame.origin.x = ((CurW + i)%7)*38+5;
    frame.origin.y = ((CurW + i)/7)*35+90;
    frame.size.width = 42;
    frame.size.height = 44;
}
    [calenderView addSubview:dayBtn];
}
}

{% endhighlight %} 




